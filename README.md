# BASH scripts as plugins

A repository of shell/bash scripts, arranged as plugins.

Each plugin provides commonly used functionalities; the ```pragma.sh``` script sets up a set of functions providing the infrastructure that allows plugins not to be imported (that is: sourced) more than once. Plugins can each make use of others' functionalities by importing them via ```pragma``` instructions.

Thanks to the plugin registration mechanism provided by the ```pragma``` instructions, it is safe to import a plugin multiple times, both in one's scripts and within other plugins, because the ```pragma``` library will ensure it won't be loaded more than once.

## How to create your own plugins

Each plugin is a shell script with some ```pragma``` instructions added at the top and at the bottom. They are located in a common directory:
- if ```$PLUGINSLIB``` is specified, they are fetched from there, otherwise 
- if a directory named ```.plugins``` exists under the user's home directory, they are taken from there, otherwise
- if a ```.plugins``` directory exists under the current directory, the ```pragma``` loader will look there.

Each plugin has a backing script whose name must follow a simple convention: for plugin "foo" the script must be named ```_foo.sh```.

The ```pragma``` loader can be instructed to reset its registry of currently loaded plugins (```pragma reset```); this allows to **reload** a plugin multiple times. Note, however, that since ```pragma``` does not know which definitions a given plugin inserts into the current shell, it is not capable of undefining any functions that have previously been defined. Still, by issuing a ```pragma reset && pragma import foo``` command you can provide a new implementation of the functions you are developing and **overwrite** any existing definition by reloading the same plugin.

## How to set up the environment

In order to start working:
1. export ```PLUGINSLIB```, or copy/create ```.plugins``` under your home directory or under the current directory;
2. source ```pragma.sh``` into the current shell (```. ./pragma.sh```)
3. to create the stub of a new plugin "foo", use ```pragma stub foo```, then proceed to editing the ```_foo.sh``` file in your plugin directory.
4. to import plugin "foo", simply write ```pragma import foo``` at the top of your script.

## Example script

```bash
#!/bin/bash

# source it like this, or better do it in the shell before running the script.
source ./pragma.sh

pragma import log

function foo() {
    log_i "this uses an imported function"
}

log_e "this uses an imported function too"
```

## Example plugin

If you run ```pragma stub foo``` after having sourced the ```pragma.sh``` library into your shell, it will create a stub for plugin "foo" under the current plugin directory. 

The current plugin directory is printed by the ```pragma directory``` command, so you can always know where your plugins are being loaded from.

The following is the stub automatically generated by ```pragma stub foo```:

```bash
#!/bin/bash

pragma begin foo

pragma import log

#
# foo_test() is an example function.
#
foo_test() {
    log_i "hallo from foo!"
}

pragma end foo
```

You can then add more functions, variables and constants (read-only variables) to the plugin.

Enjoy!
